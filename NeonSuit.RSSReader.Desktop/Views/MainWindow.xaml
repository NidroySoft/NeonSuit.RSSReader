<Window x:Class="NeonSuit.RSSReader.Desktop.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:wpf="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        xmlns:vm="clr-namespace:NeonSuit.RSSReader.Desktop.ViewModels"
        mc:Ignorable="d"
        Title="NeonSuit RSS Reader" 
        Height="900" Width="1600"
        MinHeight="700" MinWidth="1200"
        WindowStartupLocation="CenterScreen"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        Background="{DynamicResource MaterialDesignPaper}">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="0" 
                      ResizeBorderThickness="5"
                      GlassFrameThickness="0"
                      CornerRadius="0"/>
    </WindowChrome.WindowChrome>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Enterprise Command Bar -->
        <materialDesign:ColorZone Mode="PrimaryMid" 
                                  Grid.Row="0"
                                  Padding="16,8"
                                  materialDesign:ElevationAssist.Elevation="Dp4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Logo & Title -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="Rss" 
                                             Foreground="{DynamicResource PrimaryHueMidForegroundBrush}"
                                             Width="28" Height="28"
                                             Margin="0,0,12,0"/>
                    <TextBlock Text="NeonSuit RSS"
                               FontSize="20"
                               FontWeight="Medium"
                               Foreground="{DynamicResource PrimaryHueMidForegroundBrush}"
                               VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Central Commands -->
                <StackPanel Grid.Column="1" 
                            Orientation="Horizontal"
                            HorizontalAlignment="Center">
                    <Button Style="{StaticResource MaterialDesignRaisedButton}"
                            Foreground="{DynamicResource PrimaryHueMidForegroundBrush}"
                            Background="{DynamicResource PrimaryHueLightBrush}"
                            BorderBrush="{DynamicResource PrimaryHueLightBrush}"
                            Command="{Binding AddNewFeedCommand}"
                            ToolTip="Agregar nuevo feed">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Plus" Margin="0,0,8,0"/>
                            <TextBlock Text="Agregar Feed"/>
                        </StackPanel>
                    </Button>

                    <Button Style="{StaticResource MaterialDesignFlatButton}"
                            Foreground="{DynamicResource PrimaryHueMidForegroundBrush}"
                            Command="{Binding RefreshAllFeedsCommand}"
                            ToolTip="Actualizar todos los feeds"
                            Margin="8,0">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Refresh" Margin="0,0,8,0"/>
                            <TextBlock Text="Actualizar Todo"/>
                        </StackPanel>
                    </Button>

                    <Button Style="{StaticResource MaterialDesignFlatButton}"
                            Foreground="{DynamicResource PrimaryHueMidForegroundBrush}"
                            Command="{Binding MarkAllReadCommand}"
                            ToolTip="Marcar todos como leídos"
                            Margin="0,0,16,0">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="EmailCheck" Margin="0,0,8,0"/>
                            <TextBlock Text="Marcar Leídos"/>
                        </StackPanel>
                    </Button>

                    <!-- Global Search -->
                    <materialDesign:Card Width="300" UniformCornerRadius="4">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <materialDesign:PackIcon Kind="Magnify" 
                                                     Grid.Column="0" 
                                                     Margin="8,0,4,0"
                                                     VerticalAlignment="Center"
                                                     Foreground="{DynamicResource MaterialDesignBody}"/>
                            <TextBox Grid.Column="1"
                                     materialDesign:HintAssist.Hint="Buscar artículos..."
                                     materialDesign:TextFieldAssist.DecorationVisibility="Hidden"
                                     BorderThickness="0"
                                     MinWidth="200"
                                     VerticalAlignment="Center"
                                     Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}"/>
                        </Grid>
                    </materialDesign:Card>
                </StackPanel>

                <!-- Right Side Controls -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <materialDesign:PopupBox PlacementMode="BottomAndAlignRightEdges"
                                             StaysOpen="False"
                                             Margin="0,0,8,0"
                                             Foreground="{DynamicResource PrimaryHueMidForegroundBrush}">
                        <StackPanel>
                            <Button Command="{Binding ToggleThemeCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="ThemeLightDark" Margin="0,0,8,0"/>
                                    <TextBlock Text="Cambiar tema"/>
                                </StackPanel>
                            </Button>
                            <Separator/>
                            <Button>
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="AccountCog" Margin="0,0,8,0"/>
                                    <TextBlock Text="Perfil"/>
                                </StackPanel>
                            </Button>
                            <Button>
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Cog" Margin="0,0,8,0"/>
                                    <TextBlock Text="Configuración"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </materialDesign:PopupBox>

                    <Button Style="{StaticResource MaterialDesignIconButton}"
                            Foreground="{DynamicResource PrimaryHueMidForegroundBrush}"
                            Click="MinimizeButton_Click">
                        <materialDesign:PackIcon Kind="WindowMinimize"/>
                    </Button>
                    <Button Style="{StaticResource MaterialDesignIconButton}"
                            Foreground="{DynamicResource PrimaryHueMidForegroundBrush}"
                            Click="MaximizeButton_Click">
                        <materialDesign:PackIcon Kind="WindowMaximize"/>
                    </Button>
                    <Button Style="{StaticResource MaterialDesignIconButton}"
                            Foreground="{DynamicResource PrimaryHueMidForegroundBrush}"
                            Click="CloseButton_Click">
                        <materialDesign:PackIcon Kind="Close"/>
                    </Button>
                </StackPanel>
            </Grid>
        </materialDesign:ColorZone>

        <!-- Main Content Area -->
        <Grid Grid.Row="1" x:Name="MainContentGrid">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="320" MinWidth="250"/>
                <!-- Left Sidebar -->
                <ColumnDefinition Width="Auto"/>
                <!-- Splitter -->
                <ColumnDefinition Width="400" MinWidth="300"/>
                <!-- Center Articles -->
                <ColumnDefinition Width="Auto"/>
                <!-- Splitter -->
                <ColumnDefinition Width="*"/>
                <!-- Right Preview -->
            </Grid.ColumnDefinitions>

            <!-- Left Sidebar: Feed Management -->
            <Grid Grid.Column="0" Margin="16,16,0,16">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Add Feed Card -->
                <materialDesign:Card Grid.Row="0" Padding="16" Margin="0,0,0,16" UniformCornerRadius="4">
                    <StackPanel>
                        <TextBlock Text="Agregar Nuevo Feed" 
                                   Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                   Margin="0,0,0,12"/>
                        <TextBox materialDesign:HintAssist.Hint="URL del feed RSS"
                                 Text="{Binding NewFeedUrl, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                 Margin="0,0,0,12"/>
                        <Button Command="{Binding AddNewFeedCommand}" 
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                HorizontalAlignment="Stretch">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Plus" Margin="0,0,8,0"/>
                                <TextBlock Text="Agregar Feed"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Feeds List -->
                <materialDesign:Card Grid.Row="1" UniformCornerRadius="4">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" 
                                   Text="FUENTES DE NOTICIAS" 
                                   Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                   Margin="16,16,16,8"
                                   Foreground="{DynamicResource PrimaryHueMidBrush}"/>

                        <ListBox Grid.Row="1"
                                 ItemsSource="{Binding Feeds}"
                                 SelectedItem="{Binding SelectedFeed}"
                                 Margin="8"
                                 SelectionMode="Single">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <materialDesign:Card Margin="0,0,0,8" Padding="12" UniformCornerRadius="4">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <Button Grid.Column="0"
                                                    Style="{StaticResource MaterialDesignFlatButton}"
                                                    HorizontalContentAlignment="Left"
                                                    Command="{Binding DataContext.RefreshArticlesCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}">
                                                <TextBlock Text="{Binding Title}" 
                                                           TextTrimming="CharacterEllipsis"
                                                           FontWeight="Medium"/>
                                            </Button>

                                            <Button Grid.Column="1"
                                                    Style="{StaticResource MaterialDesignIconButton}"
                                                    Command="{Binding DataContext.DeleteFeedCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}"
                                                    ToolTip="Eliminar fuente">
                                                <materialDesign:PackIcon Kind="Delete" />
                                            </Button>
                                        </Grid>
                                    </materialDesign:Card>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>
                </materialDesign:Card>
            </Grid>

            <!-- First Splitter -->
            <GridSplitter Grid.Column="1" 
                          Width="8" 
                          Background="Transparent"
                          ShowsPreview="True">
                <GridSplitter.Template>
                    <ControlTemplate>
                        <Border Background="Transparent" Cursor="SizeWE">
                            <Rectangle Fill="{DynamicResource MaterialDesignDivider}" 
                                       Width="1" 
                                       HorizontalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </GridSplitter.Template>
            </GridSplitter>

            <!-- Center Panel: Articles List -->
            <materialDesign:Card Grid.Column="2" Margin="0,16,0,16" UniformCornerRadius="4">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" 
                               Text="{Binding SelectedFeed.Title, FallbackValue='Todos los Artículos'}" 
                               Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                               Margin="16,16,16,8"
                               Foreground="{DynamicResource PrimaryHueMidBrush}"/>

                    <ListView Grid.Row="1"
                              x:Name="ArticlesList"
                              ItemsSource="{Binding Articles}"
                              SelectedItem="{Binding SelectedArticle}"
                              SelectionChanged="ArticlesList_SelectionChanged"
                              ScrollViewer.CanContentScroll="True"
                              VirtualizingPanel.IsVirtualizing="True"
                              VirtualizingPanel.VirtualizationMode="Recycling"
                              Margin="8"
                              SelectionMode="Single">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <materialDesign:Card Width="340" 
                                 Height="180" 
                                 Margin="4" 
                                 Padding="12"
                                 VerticalAlignment="Top"
                                 materialDesign:ElevationAssist.Elevation="Dp2">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Row="0" Grid.Column="0"
                               Text="{Binding Title}" 
                               FontWeight="Bold"
                               TextWrapping="Wrap"
                               MaxHeight="50"
                               TextTrimming="CharacterEllipsis"
                               Margin="0,0,8,4"/>

                                        <TextBlock Grid.Row="1" Grid.Column="0"
                               Text="{Binding PublishedDate, StringFormat='{}{0:dd MMM yyyy HH:mm}'}"
                               Style="{StaticResource MaterialDesignCaptionTextBlock}"
                               Opacity="0.7"
                               Margin="0,0,0,4"/>

                                        <TextBlock Grid.Row="2" Grid.Column="0"
                               Text="{Binding Summary}"
                               TextTrimming="CharacterEllipsis"
                               MaxHeight="60"
                               TextWrapping="Wrap"/>

                                        <StackPanel Grid.Row="0" Grid.Column="1" Grid.RowSpan="3" 
                                VerticalAlignment="Top" Margin="4,0,0,0">

                                            <materialDesign:PackIcon x:Name="StatusIcon" 
                                                 Kind="CircleOutline"
                                                 Foreground="{DynamicResource PrimaryHueMidBrush}"
                                                 Opacity="0.5"
                                                 Margin="0,0,0,8"
                                                 HorizontalAlignment="Right"/>

                                            <materialDesign:PackIcon x:Name="FavoriteIcon"
                                                 Kind="StarOutline"
                                                 Foreground="Gold"
                                                 Opacity="0.5"
                                                 HorizontalAlignment="Right"/>
                                        </StackPanel>
                                    </Grid>
                                </materialDesign:Card>

                                <DataTemplate.Triggers>
                                    <DataTrigger Binding="{Binding Status}" Value="Unread">
                                        <Setter TargetName="StatusIcon" Property="Kind" Value="CheckCircle" />
                                        <Setter TargetName="StatusIcon" Property="Opacity" Value="1" />
                                        <Setter TargetName="StatusIcon" Property="Foreground" Value="#00FBFF" />
                                    </DataTrigger>

                                    <DataTrigger Binding="{Binding IsFavorite}" Value="True">
                                        <Setter TargetName="FavoriteIcon" Property="Kind" Value="Star" />
                                        <Setter TargetName="FavoriteIcon" Property="Opacity" Value="1" />
                                    </DataTrigger>
                                </DataTemplate.Triggers>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>
            </materialDesign:Card>

            <!-- Second Splitter -->
            <GridSplitter Grid.Column="3" 
                          Width="8" 
                          Background="Transparent"
                          ShowsPreview="True">
                <GridSplitter.Template>
                    <ControlTemplate>
                        <Border Background="Transparent" Cursor="SizeWE">
                            <Rectangle Fill="{DynamicResource MaterialDesignDivider}" 
                                       Width="1" 
                                       HorizontalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </GridSplitter.Template>
            </GridSplitter>

            <!-- Right Preview Panel -->
            <Grid Grid.Column="4" Margin="0,16,16,16">
                <Border materialDesign:ElevationAssist.Elevation="Dp1" Background="White">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Preview Toolbar -->
                        <materialDesign:ColorZone Grid.Row="0" 
                                                  Mode="Standard" 
                                                  Padding="8"
                                                  materialDesign:ElevationAssist.Elevation="Dp2">
                            <StackPanel Orientation="Horizontal">
                                <Button Style="{StaticResource MaterialDesignIconButton}"
                                        ToolTip="Abrir en navegador externo"
                                        Command="{Binding OpenInBrowserCommand}"
                                        CommandParameter="{Binding SelectedArticle}">
                                    <materialDesign:PackIcon Kind="OpenInNew"/>
                                </Button>
                                <Button Style="{StaticResource MaterialDesignIconButton}"
                                        ToolTip="Copiar enlace"
                                        Command="{Binding CopyLinkCommand}"
                                        CommandParameter="{Binding SelectedArticle}">
                                    <materialDesign:PackIcon Kind="ContentCopy"/>
                                </Button>
                                <Separator Style="{StaticResource MaterialDesignSeparator}" 
                                           Margin="8,0"/>
                                <ToggleButton Style="{StaticResource MaterialDesignIconButton}"
                                              ToolTip="Pantalla completa"
                                              x:Name="FullScreenToggle"
                                              Checked="FullScreenToggle_Checked"
                                              Unchecked="FullScreenToggle_Unchecked">
                                    <materialDesign:PackIcon Kind="Fullscreen"/>
                                </ToggleButton>
                            </StackPanel>
                        </materialDesign:ColorZone>

                        <!-- WebView2 Container -->
                        <wpf:WebView2 Grid.Row="1" 
                                      x:Name="MyWebView" 
                                      Source="about:blank"/>
                    </Grid>
                </Border>
            </Grid>
        </Grid>

        <!-- Snackbar for notifications -->
        <materialDesign:Snackbar Grid.RowSpan="2" MessageQueue="{Binding MessageQueue}" />
    </Grid>
</Window>